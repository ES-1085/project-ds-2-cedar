

# Load Packages & Data

```{r load-packages, warning = FALSE, echo = FALSE, message = FALSE}
library(gtable)
library(ggridges)
library(htmltools)
library(knitr)
library(leaflet)
library(lubridate)
library(RColorBrewer)
library(tidymodels)
library(tidyverse)
```

```{r load-data}
ahrf_2019_2020 <- read.csv("~/Desktop/GitHub/data_science_2/data/ahrf_2019_2020_maine.csv")
ahrf_2020_2021 <- read.csv("~/Desktop/GitHub/data_science_2/data/ahrf_2020_2021_maine.csv")
ahrf_2021_2022 <- read.csv("~/Desktop/GitHub/data_science_2/data/ahrf_2021_2022_maine.csv")
ahrf_2022_2023 <- read.csv("~/Desktop/GitHub/data_science_2/data/ahrf_2022_2023_maine.csv")
ahrf_2019_2023 <- read.csv("~/Desktop/GitHub/data_science_2/data/ahrf_2019_2023.csv")
hpsa_pc_provider_counts <- read.csv("~/Desktop/GitHub/data_science_2/data/hpsa_pc_provider_counts.csv")
county_pop <- read.csv("~/Desktop/GitHub/data_science_2/data/county_pop.csv")
md <- read.csv("~/Desktop/GitHub/data_science_2/data/md.csv")
md_counts <- read.csv("~/Desktop/GitHub/data_science_2/data/md_counts.csv")
do_counts <- read.csv("~/Desktop/GitHub/data_science_2/data/do_counts.csv")
hpsa_pc <- read.csv("~/Desktop/GitHub/data_science_2/data/hpsa_pc.csv")
hpsa_dental <- read.csv("~/Desktop/GitHub/data_science_2/data/hpsa_dental.csv")
hpsa_mh <- read.csv("~/Desktop/GitHub/data_science_2/data/hpsa_mh.csv")
all_physicians <- read.csv("~/Desktop/GitHub/data_science_2/data/all_physicians.csv")
hosp_adm_data <- read.csv("~/Desktop/GitHub/data_science_2/data/hosp_adm_data.csv")
hosp_data <- read.csv("~/Desktop/GitHub/data_science_2/data/hosp_data.csv")
care_types <- read.csv("~/Desktop/GitHub/data_science_2/data/care_types.csv")
dental_care <- read.csv("~/Desktop/GitHub/data_science_2/data/dental_care.csv")
nurses <- read.csv("~/Desktop/GitHub/data_science_2/data/nurses.csv")
facility_types <- read.csv("~/Desktop/GitHub/data_science_2/data/facility_types.csv")
```


# Initial Exploration

```{r hpsa-score-change}
hpsa_pc %>% 
  ggplot(aes(x = data_year, y = hpsa_pc_score)) +
  geom_line(color = "#00C377") +
  facet_wrap(~ county_name)

hpsa_dental %>% 
  ggplot(aes(x = data_year, y = hpsa_dental_score)) +
  geom_line(color = "#00C377") +
  facet_wrap(~ county_name)

hpsa_mh %>% 
  ggplot(aes(x = data_year, y = hpsa_mh_score)) +
  geom_line(color = "#00C377") + 
  facet_wrap(~ county_name)
```

```{r primary-care-provider-counts}
hpsa_pc_provider_counts %>% 
  ggplot() +
  geom_col(aes(x = count_year, y = pc_physician_count), fill = "#00608E") +
  geom_col(aes(x = count_year, y = md_pc_count), fill = "#00AF8C") +
  geom_col(aes(x = count_year, y = do_pc_count), fill = "#FDE333") +
  facet_wrap(~ county_name)

hpsa_pc_provider_counts %>% 
  ggplot() +
  geom_col(aes(x = count_year, y = pc_physician_count/cens_popn_20), fill = "#00608E") +
  geom_col(aes(x = count_year, y = md_pc_count/cens_popn_20), fill = "#00AF8C") +
  geom_col(aes(x = count_year, y = do_pc_count/cens_popn_20), fill = "#FDE333") +
  facet_wrap(~ county_name)

hpsa_pc_provider_counts %>% 
  ggplot() +
  geom_line(aes(x = count_year, y = pc_physician_count)) +
  geom_line(aes(x = count_year, y = md_pc_count)) +
  geom_line(aes(x = count_year, y = do_pc_count)) +
  facet_wrap(~ county_name)

hpsa_pc_provider_counts %>% 
  ggplot() +
  geom_line(aes(x = count_year, y = pc_physician_count/cens_popn_20)) +
  geom_line(aes(x = count_year, y = md_pc_count/cens_popn_20)) +
  geom_line(aes(x = count_year, y = do_pc_count/cens_popn_20)) +
  facet_wrap(~ county_name)
```

```{r active-md-count-by-year}
md_active %>% 
  ggplot(aes(x = active_md_data_year, y = active_md_count, fill = active_md_data_year)) +
  geom_col() +
  facet_wrap(~ county_name) +
  scale_fill_viridis_c()
```

```{r}
care_types %>% 
  filter(count != "0") %>% 
  ggplot(aes(y = care_type, fill = cnty_name)) +
  geom_col(position = "dodge") +
  facet_wrap(~ cnty_name, scales = "free")
```


```{r psych-care-by-county}
care_types %>% 
  filter(care_type %in% c("natal_postprtm_psych_svc", "psych_care", "psych_conslt_svc", "psych_conslttn_lisn_svc", "psych_eductnl_svc", "psych_gertrc_svc", "psych_intensv_outpt_svc", "psych_outpt_svc", "psych_ped_care_svc", "psych_php_adult", "psych_php_ped", "psych_rsdntl_tx_adult", "psych_rsdntl_tx_ped")) %>% 
  filter(count != "0") %>% 
  ggplot(aes(x = care_type, y = count, fill = cnty_name)) +
  geom_col() +
  coord_flip() +
  facet_wrap(~ cnty_name, scales = "free") +
  scale_fill_viridis_d()
```

```{r birth-care-by-county}
care_types %>% 
  filter(care_type %in% c("birth_postprtm_rm", "obstetrc_care")) %>% 
  filter(count != "0") %>% 
  ggplot(aes(x = care_type, y = count, fill = cnty_name)) +
  geom_col() +
  coord_flip() +
  facet_wrap(~ cnty_name) +
  scale_fill_viridis_d()
```

```{r ambulance-service-by-county}
care_types %>% 
  filter(care_type %in% c("air_amb_svc", "amb_svc")) %>% 
  filter(count != "0") %>% 
  ggplot(aes(x = care_type, y = count, fill = cnty_name)) +
  geom_col() +
  coord_flip() +
  facet_wrap(~ cnty_name) +
  scale_fill_viridis_d()
```

```{r substance-use-treatment-by-county}
care_types %>% 
  filter(care_type %in% c("substnc_use_php", "substnc_use_ped_svc", "substnc_use_outpt_svc", "substnc_use_inpat_care", "substnc_use_outpt_svc")) %>%
  filter(count != "0") %>% 
  ggplot(aes(x = care_type, y = count, fill = cnty_name)) +
  geom_col() +
  coord_flip() +
  facet_wrap(~ cnty_name, scales = "free") +
  scale_fill_viridis_d()
```

```{r}
hosp_data %>% 
  count(county_name, hosp_count_year, hosp_count, stgh_count, lth_count, sth_psych_count, sth_child_med_count, sth_child_psych_count, lth_psych_count, lth_child_psych_count, sth_comn_count, vetn_hosp_count, stgh_critcl_access_count, sole_comn_provdrs_count)
```

```{r}
hosp_adm_data %>% 
  count(county_name, hosp_adm_count_year, hosp_adm_count, stgh_hosp_count, stnglth_hosp_count, sth_comn_hosp_count)
```

```{r}
dental_care %>% 
  count(cnty_name, dent_data_year, active_dentist_count)
```

```{r}
facility_types %>% 
  count(cnty_name, facility_type_data_year, rural_health_clinic_count, community_mh_center_count, fqhc_count)
```

```{r}
md %>% 
  ggplot(aes(x = md_data_year, y = active_md_count)) +
  geom_line() +
  facet_wrap(~ county_name)

md %>% 
  ggplot(aes(x = md_data_year, y = all_md_patient_care_count)) +
  geom_line() +
  facet_wrap(~ county_name)
```

```{r}
nurses %>% 
  count(cnty_name, np_year, np_count, clin_nurse_count, crna_count, apn_midwives_count)
```

```{r}
all_physicians %>% 
  filter(md_allergy_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_allergy_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_allergy_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_anesth_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_anesth_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_anesth_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_card_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_card_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_card_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_derm_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_derm_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_derm_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_emerg_med_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_emerg_med_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_emerg_med_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_fammed_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_fammed_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_fammed_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_gastr_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_gastr_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_gastr_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_genintmed_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_genintmed_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_genintmed_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_gen_surg_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_gen_surg_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_gen_surg_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_neuro_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_neuro_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_neuro_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_obgyn_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_obgyn_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_obgyn_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_ophth_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_ophth_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_ophth_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_psych_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_psych_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_psych_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_spec_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_spec_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_spec_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_surg_spec_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_surg_spec_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_gen_surg_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(all_gp_md_count != "0") %>% 
  ggplot(aes(x = county_name, y = all_gp_md_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = all_gp_md_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_child_psych_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_child_psych_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_child_psych_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(md_gen_ped_count != "0") %>% 
  ggplot(aes(x = county_name, y = md_gen_ped_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = md_gen_ped_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(do_fammed_count != "0") %>% 
  ggplot(aes(x = county_name, y = do_fammed_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = do_fammed_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(do_ped_count != "0") %>% 
  ggplot(aes(x = county_name, y = do_ped_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = do_ped_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(do_obgyn_count != "0") %>% 
  ggplot(aes(x = county_name, y = do_obgyn_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = do_obgyn_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(do_gen_surg_count != "0") %>% 
  ggplot(aes(x = county_name, y = do_gen_surg_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = do_gen_surg_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(do_emerg_med_count != "0") %>% 
  ggplot(aes(x = county_name, y = do_emerg_med_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = do_emerg_med_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```

```{r}
all_physicians %>% 
  filter(do_psych_count != "0") %>% 
  ggplot(aes(x = county_name, y = do_oth_spec_count)) +
  geom_col(position = "dodge") +
  coord_flip() +
  facet_wrap(~ physician_count_year, scales = "free")

all_physicians %>% 
  ggplot(aes(x = physician_count_year, y = do_oth_spec_count/census_count)) +
  geom_smooth(method = "lm", color = "grey") +
  geom_line(alpha = 0.5) +
  facet_wrap(~ county_name)
```




# Analysis

```{r gp-md-change-model}
all_physicians %>% 
  ggplot(aes(x = popn_est_count, y = all_gp_md_count)) + 
  geom_point(position = "jitter", alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE)

(gp_md_change_pop <- linear_reg() %>% 
  set_engine("lm") %>% 
  fit(all_gp_md_count ~ physician_count_year + county_name + popn_est_count, data = all_physicians))

tidy(gp_md_change_pop)

(gp_md_change_pop_aug <- augment(gp_md_change_pop$fit))

gp_md_change_pop_aug %>% 
  ggplot(aes(x = .fitted, y = .resid)) + 
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE)

glance(gp_md_change_pop)$r.squared %>% 
  tidy()
glance(gp_md_change_pop)$adj.r.squared %>% 
  tidy()
```

```{r}
hpsa_pc_provider_counts %>% 
  ggplot(aes(x = count_year, y = pc_physician_count)) + 
  geom_point(position = "jitter", alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE)

(pc_provider_change <- linear_reg() %>% 
  set_engine("lm") %>% 
  fit(pc_physician_count ~ count_year + county_name, data = hpsa_pc_provider_counts))

tidy(pc_provider_change)

(pc_provider_change_aug <- augment(pc_provider_change$fit))

pc_provider_change_aug %>% 
  ggplot(aes(x = .fitted, y = .resid)) + 
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE)

glance(gp_md_change_pop)$r.squared %>% 
  tidy()
glance(gp_md_change_pop)$adj.r.squared %>% 
  tidy()
```






